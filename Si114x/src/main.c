/*
 ============================================================================
 Name			: main.c
 Author			: wjdgn2574
 Version		: 0.7
 Copyright		:
 Description	: Do Test lib_ADXL362 library
 ============================================================================
*/

/*******************************************************************************
 * Includes
 ******************************************************************************/
// C Standard Library
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>

// Library
#include "lib_Si114x.h"

/*******************************************************************************
 * Private define
 ******************************************************************************/

/*******************************************************************************
 * Private macro
 ******************************************************************************/

/*******************************************************************************
 * Private typedef
 ******************************************************************************/

/*******************************************************************************
 * Private variables
 ******************************************************************************/

/*******************************************************************************
 * Private function prototypes
 ******************************************************************************/
void init_Si1141(Si114x *p_si1141);

/*******************************************************************************
 * Main Loop
 ******************************************************************************/
int main(void)
{
	Si114x si1141;

	init_Si1141(&si1141);

	printf("Start Si1141 TEST Application \r\n");

    while (true)
    {
    	get_Data_SI114X(SI114X_DATA_ALS_VIS, &si1141);
    	get_Data_SI114X(SI114X_DATA_ALS_IR, &si1141);
    	get_Data_SI114X(SI114X_DATA_PS1, &si1141);

    	printf("VIS = %d, IR = %d, PS1 = %d \r\n", si1141.data_VIS_ALS, si1141.data_IR_ALS, si1141.data_PS1);
    }
}

/*******************************************************************************
 * Private Functions
 ******************************************************************************/
void init_Si1141(Si114x *p_si1141)
{
	if(get_Register_SI114X(SI114X_PART_ID) == SI114X_PART_ID_VALUE)
	{
		command_SI114X(SI114X_CMD_RESET);
		sleep(30); // delay 30ms

		set_Register_SI114X(SI114X_HW_KEY, SI114X_HW_KEY_VAL0);
		set_LED_SI114X(LEDI_359_MA, 0x00, 0x00);
		set_Register_SI114X(SI114X_PARAM_WR, (SI114X_MCL_ALS_IR_TASK + SI114X_MCL_ALS_VIS_TASK + SI114X_MCL_PS1_TASK));
		command_SI114X(SI114X_CMD_PARAM_SET + (SI114X_RAM_CHLIST & 0x1F));
		set_Int_Cfg_SI114X(0x00, 0x00);
		set_Irq_Enable_SI114X(0x00, 0x00, 0x00, 0x00, 0x00);
		set_Irq_Mode_SI114X(0x00, 0x00, 0x00, 0x00, 0x00);
	}
}
